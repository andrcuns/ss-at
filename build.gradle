buildscript {
    repositories {
        jcenter()
    }
    dependencies {
        classpath "io.qameta.allure:allure-gradle:2.4"
    }
}

repositories {
    jcenter()
}

apply plugin: 'java'
apply plugin: 'idea'

apply from: "${rootDir}/gradle/cuke_reporter.gradle"
apply from: "${rootDir}/gradle/allure.gradle"
apply from: "${rootDir}/gradle/dependencies.gradle"

dependencies {
    compile libs.selenium
    compile libs.logging
    compile libs.cucumber
    compile libs.spring
    compile webdrivermanager
    testCompile junit
}

task runCukeTests(type: Test) {
    description = 'Geb based UI tests execution in sequence'

    String cucumberTags = project.findProperty('tags') ?: '~@incomplete'
    String webdriver = project.findProperty('webdriver') ?: 'chrome'
    String report = project.findProperty('report') ?: 'cucumber'
    Map reportPlugin = [
            cucumber: "--plugin json:${reporting.baseDir}/cucumber/features.json",
            allure  : "--plugin io.qameta.allure.cucumberjvm.AllureCucumberJvm",
            junit   : ""
    ]

    jvmArgs "-Dwebdriver=${webdriver}", "-Dcucumber.options=--tags ${cucumberTags} ${reportPlugin[report]}"

    testLogging {
        events "standardOut"
    }

    if (report == 'cucumber') {
        doLast {
            generateCucumberReport()
        }
    }
}